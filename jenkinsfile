pipeline {
    agent { label '172.16.0.211' }  // Your Windows node label
    stages {
        stage('Run PowerShell with Credentials') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'windows-admin-creds', usernameVariable: 'ADMIN_USER', passwordVariable: 'ADMIN_PASS')]) {
                    powershell """
				$securePass = ConvertTo-SecureString $env:ADMIN_PASS -AsPlainText -Force  # Assuming passed via env vars
				$cred = New-Object System.Management.Automation.PSCredential ($env:ADMIN_USER, $securePass)
				Start-Process powershell.exe -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File 'C:\path\to\expand_disk.ps1'" -Credential $cred -Wait -NoNewWindow
                    """
                }
            }
        }
    }
}


